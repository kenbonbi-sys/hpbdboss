<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday, Jenny ‚ú®</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÇ</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#0d0f1a;--bg2:#1a0f24;
      --card:rgba(255,255,255,.06);--card-hover:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.94);--muted:rgba(255,255,255,.68);
      --accent1:#ffc2d1;--accent2:#ffe5b4;--accent3:#d4b8ff;--accent4:#b8e0ff;
      --glass:rgba(255,255,255,.04);
      --border:rgba(255,255,255,.08);--border-light:rgba(255,255,255,.14);
      --shadow-color:rgba(0,0,0,.45);
      --glow1:rgba(255,194,209,.22);--glow2:rgba(212,184,255,.18);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{
      min-height:100vh;color:var(--text);
      font-family:'DM Sans',system-ui,-apple-system,sans-serif;
      background:
        radial-gradient(ellipse 1400px 900px at 15% 5%,var(--glow1),transparent 60%),
        radial-gradient(ellipse 1000px 800px at 85% 20%,var(--glow2),transparent 55%),
        radial-gradient(ellipse 1200px 700px at 50% 100%,rgba(255,229,180,.08),transparent 50%),
        linear-gradient(175deg,var(--bg1) 0%,var(--bg2) 100%);
      background-attachment:fixed;overflow-x:hidden;line-height:1.6;
    }
    body.noScroll{overflow:hidden}
    body::before{
      content:"";position:fixed;inset:0;
      background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity:.015;pointer-events:none;z-index:1000;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1140px;margin:0 auto;padding:28px 20px 100px}

    .nav{position:sticky;top:0;z-index:50;backdrop-filter:blur(20px) saturate(1.4);-webkit-backdrop-filter:blur(20px) saturate(1.4);background:rgba(13,15,26,.72);border-bottom:1px solid var(--border)}
    .navIn{max-width:1140px;margin:0 auto;padding:12px 20px;display:flex;align-items:center;gap:14px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px;font-family:'Playfair Display',serif;font-weight:700;font-size:18px;cursor:pointer;letter-spacing:.02em;background:linear-gradient(135deg,var(--accent1),var(--accent3));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .links{display:flex;gap:6px;flex-wrap:wrap}
    .links a{font-size:13px;font-weight:500;color:var(--muted);padding:8px 12px;border-radius:10px;transition:all .2s ease}
    .links a:hover{color:var(--text);background:var(--glass)}
    .links a.active{color:var(--text);background:linear-gradient(135deg,rgba(255,194,209,.12),rgba(212,184,255,.10));border:1px solid rgba(255,229,180,.25)}
    .spacer{flex:1}
    @media(max-width:900px){.links{display:none}.menuToggle{display:flex!important}h1{font-size:34px!important}}
    .menuToggle{display:none;align-items:center;justify-content:center;width:42px;height:42px;background:var(--glass);border:1px solid var(--border);color:var(--text);border-radius:12px;cursor:pointer;font-size:18px;transition:all .2s}
    .menuToggle:hover{background:var(--card-hover)}
    .links.show{display:flex!important;width:100%;flex-direction:column;gap:4px;padding:12px 0 4px}
    .links.show a{border:1px solid var(--border);background:var(--glass);border-radius:12px}

    .progressWrap{height:3px;background:rgba(255,255,255,.05);position:relative;overflow:hidden}
    .progressBar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));box-shadow:0 0 20px rgba(255,194,209,.35);transition:width .08s linear}

    .btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;border:1px solid var(--border-light);background:var(--glass);color:var(--text);padding:11px 16px;border-radius:14px;font-family:'DM Sans',sans-serif;font-weight:600;font-size:14px;cursor:pointer;transition:all .25s ease;backdrop-filter:blur(8px)}
    .btn:hover{background:var(--card-hover);border-color:rgba(255,255,255,.2);transform:translateY(-2px);box-shadow:0 8px 25px var(--shadow-color)}
    .btnPrimary{background:linear-gradient(135deg,var(--accent1) 0%,var(--accent2) 50%,var(--accent3) 100%);background-size:200% 200%;animation:gradientShift 4s ease infinite;color:#1a1a2e;border:none;font-weight:700;box-shadow:0 8px 32px rgba(255,194,209,.3)}
    .btnPrimary:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 12px 40px rgba(255,194,209,.4)}
    @keyframes gradientShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:24px;padding:24px;box-shadow:0 24px 80px var(--shadow-color);backdrop-filter:blur(12px);transition:all .35s ease;position:relative;overflow:hidden}
    .card::before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.03) 0%,transparent 50%);pointer-events:none}
    .card:hover{border-color:var(--border-light);transform:translateY(-4px);box-shadow:0 32px 100px var(--shadow-color)}
    .reveal{opacity:0;transform:translateY(14px) scale(.995);filter:saturate(.98);transition:opacity .7s ease, transform .7s ease, filter .7s ease}
    .reveal.in{opacity:1;transform:translateY(0) scale(1);filter:saturate(1)}

    .kicker{font-size:11px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;color:var(--accent1);margin-bottom:8px}
    h1{font-family:'Playfair Display',serif;font-size:46px;font-weight:800;line-height:1.1;margin-bottom:16px;background:linear-gradient(135deg,#fff 0%,var(--accent1) 50%,var(--accent3) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    h2{font-family:'Playfair Display',serif;font-size:28px;font-weight:700;margin-bottom:12px;color:var(--text)}
    p{color:var(--muted);margin:10px 0;font-size:15px}
    .hr{height:1px;border:0;margin:20px 0;background:linear-gradient(90deg,transparent,var(--border-light),transparent)}

    .grid{display:grid;gap:20px}
    .grid2{grid-template-columns:1.25fr .75fr}
    .grid3{grid-template-columns:repeat(3,1fr)}
    @media(max-width:900px){.grid2,.grid3{grid-template-columns:1fr}}
    .hero{padding:32px;position:relative}
    .glow{position:absolute;top:-150px;right:-150px;width:550px;height:550px;border-radius:50%;background:radial-gradient(circle at 30% 30%,var(--glow1),transparent 60%);pointer-events:none;animation:pulseGlow 5s ease-in-out infinite;filter:blur(40px)}
    @keyframes pulseGlow{0%,100%{opacity:.7;transform:scale(1)}50%{opacity:1;transform:scale(1.08)}}
    .pillRow{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}
    .pill{font-size:12px;font-weight:600;padding:8px 14px;border-radius:50px;border:1px solid var(--border);background:var(--glass);color:var(--muted);backdrop-filter:blur(8px);transition:all .2s}
    .pill:hover{border-color:var(--accent1);color:var(--accent1);transform:scale(1.05)}
    .stat{display:flex;gap:14px;padding:16px;border-radius:16px;border:1px solid var(--border);background:var(--glass);transition:all .25s ease;margin-bottom:12px}
    .stat:last-child{margin-bottom:0}
    .stat:hover{border-color:var(--border-light);transform:translateX(6px);background:var(--card-hover)}
    .dot{width:12px;height:12px;border-radius:50%;margin-top:5px;flex-shrink:0;background:linear-gradient(135deg,var(--accent1),var(--accent2));box-shadow:0 0 12px var(--accent1)}
    .stat b{font-size:15px;color:var(--text)}
    .stat p{margin:4px 0 0;font-size:14px}
    .secret{display:none;margin-top:16px;padding:16px;border-radius:16px;border:1px solid rgba(255,194,209,.2);background:rgba(255,194,209,.06);font-size:14px}

    .msgGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media(max-width:900px){.msgGrid{grid-template-columns:1fr}}
    .msgCard{border-radius:18px;padding:18px;border:1px solid var(--border);background:var(--glass);backdrop-filter:blur(8px);transition:all .3s ease;position:relative;overflow:hidden}
    .msgCard::after{content:"";position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));opacity:0;transition:opacity .3s}
    .msgCard:hover{transform:translateY(-6px);border-color:var(--border-light);box-shadow:0 20px 50px var(--shadow-color)}
    .msgCard:hover::after{opacity:1}
    .who{font-weight:700;font-size:15px;margin-bottom:4px}
    .tag{font-size:11px;color:var(--accent3);font-weight:600;text-transform:uppercase;letter-spacing:.08em}
    .quote{margin-top:10px;color:var(--muted);font-size:14px;line-height:1.55;font-style:italic}

    .highlight-box{background:linear-gradient(135deg,rgba(255,194,209,.1),rgba(212,184,255,.1));border:1px solid rgba(255,194,209,.2);border-radius:18px;padding:20px;margin-top:20px;position:relative;overflow:hidden}
    .highlight-box::before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,.03) 0%,transparent 60%);animation:shimmer 8s linear infinite}
    @keyframes shimmer{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    .highlight-box p{position:relative;z-index:1}

    .marquee{position:relative;overflow:hidden;border-radius:20px;border:1px solid var(--border);background:var(--glass);padding:16px 12px}
    .marquee::before,.marquee::after{content:"";position:absolute;top:0;bottom:0;width:80px;z-index:2;pointer-events:none}
    .marquee::before{left:0;background:linear-gradient(90deg,var(--bg1),transparent)}
    .marquee::after{right:0;background:linear-gradient(270deg,var(--bg1),transparent)}
    .marqueeTrack{display:flex;gap:16px;width:max-content;animation:marqueeMove 45s linear infinite}
    @keyframes marqueeMove{from{transform:translateX(0)}to{transform:translateX(-50%)}}
    .marqueeImg{width:300px;height:200px;object-fit:cover;border-radius:16px;border:2px solid var(--border);box-shadow:0 16px 50px var(--shadow-color);transition:all .35s ease}
    .marqueeImg:hover{transform:scale(1.04);border-color:var(--accent1)}
    .marquee:hover .marqueeTrack{animation-play-state:paused}
    @media(max-width:600px){.marqueeImg{width:240px;height:160px}.marqueeTrack{animation-duration:60s}}

    .audioCard audio{width:100%;margin-top:12px;border-radius:10px;filter:sepia(.1) saturate(1.2)}

    /* ===== Kalimba with Falling Notes ===== */
    .kalimbaWrap{border:1px solid var(--border);background:var(--glass);border-radius:20px;padding:20px;backdrop-filter:blur(8px);position:relative;overflow:hidden}
    .kalimbaTop{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
    @media(max-width:900px){.kalimbaTop{grid-template-columns:1fr}}
    .kalimbaHint{border:1px solid var(--border);background:var(--glass);border-radius:16px;padding:16px}
    .songLine{font-size:18px;font-weight:600;margin-top:8px;letter-spacing:.1em;font-family:'DM Sans',monospace;color:var(--accent2)}
    .songNote{font-size:12px;color:var(--muted);margin-top:10px}
    .kalimbaNow{border:1px solid rgba(255,194,209,.2);background:linear-gradient(135deg,rgba(255,194,209,.08),rgba(212,184,255,.08));border-radius:16px;padding:16px;text-align:center}
    .nowTitle{font-size:11px;color:var(--muted);letter-spacing:.15em;text-transform:uppercase}
    .nowKey{font-family:'Playfair Display',serif;font-size:42px;font-weight:800;margin-top:8px;background:linear-gradient(135deg,var(--accent1),var(--accent3));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .nowSub{font-size:12px;color:var(--muted);margin-top:6px}
    .kalimbaScore{display:flex;align-items:center;gap:16px;margin-top:12px;padding:12px 16px;border-radius:12px;background:var(--glass);border:1px solid var(--border)}
    .kalimbaScore .scoreLabel{font-size:13px;color:var(--muted)}
    .kalimbaScore .scoreNum{font-size:24px;font-weight:800;color:var(--accent2)}

    .kalimbaGameArea{position:relative;margin-top:16px;border:2px solid var(--border-light);border-radius:20px;overflow:hidden;background:linear-gradient(180deg,rgba(0,0,0,.2) 0%,transparent 100%)}
    .fallingNotesTrack{position:relative;height:180px;overflow:hidden}
    .hitZone{position:absolute;bottom:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));box-shadow:0 0 20px var(--accent1),0 0 40px var(--accent2);z-index:5}
    .fallingBlock{position:absolute;width:46px;height:50px;border-radius:10px 10px 4px 4px;background:linear-gradient(180deg,var(--accent1) 0%,var(--accent3) 100%);box-shadow:0 4px 20px rgba(255,194,209,.5);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:16px;color:#1a1a2e;transition:transform .1s,opacity .2s}
    .fallingBlock.hit{background:linear-gradient(180deg,#a7f3d0,#6ee7b7)!important;animation:blockPop .3s ease forwards}
    .fallingBlock.missed{background:linear-gradient(180deg,#fca5a5,#f87171)!important;opacity:.4}
    @keyframes blockPop{0%{transform:scale(1)}50%{transform:scale(1.3)}100%{transform:scale(0);opacity:0}}

    .kalimbaBoard{display:flex;justify-content:center;align-items:flex-start;gap:4px;flex-wrap:nowrap;overflow-x:auto;padding:0 8px 8px;position:relative;touch-action:pan-x;scroll-snap-type:x proximity;scrollbar-width:thin}
    .kalimbaBoard::-webkit-scrollbar{height:8px}
    .kalimbaBoard::-webkit-scrollbar-thumb{background:rgba(255,255,255,.10);border-radius:999px}
    .kKey{position:relative;border:1px solid var(--border-light);background:radial-gradient(120px 40px at 50% 15%, rgba(255,255,255,.09), transparent 55%),linear-gradient(180deg,var(--glass) 0%,rgba(0,0,0,.24) 100%);color:var(--text);border-radius:4px 4px 14px 14px;width:46px;min-width:46px;cursor:pointer;user-select:none;touch-action:manipulation;box-shadow:0 14px 34px rgba(0,0,0,.45);transition:all .12s ease;display:flex;align-items:flex-end;justify-content:center;padding:12px 6px;-webkit-tap-highlight-color:transparent}
    .kKey::after{content:"";position:absolute;left:10px;right:10px;top:14px;height:2px;background:rgba(255,255,255,.06);border-radius:999px}
    .kKey:hover{border-color:var(--accent1);background:radial-gradient(120px 40px at 50% 15%, rgba(255,194,209,.12), transparent 55%),linear-gradient(180deg,var(--glass) 0%,rgba(0,0,0,.24) 100%)}
    .kKey:active{transform:translateY(3px) scale(.98)}
    .kKey.guide{border-color:var(--accent2);background:radial-gradient(120px 40px at 50% 15%, rgba(255,229,180,.18), transparent 55%),linear-gradient(180deg,var(--glass) 0%,rgba(0,0,0,.24) 100%);box-shadow:0 0 26px rgba(255,229,180,.18),0 14px 34px rgba(0,0,0,.45)}
    .kKey.wrong{animation:kShake .2s ease}
    .kKey.hit{animation:keyHit .25s ease;background:radial-gradient(120px 40px at 50% 15%, rgba(167,243,208,.25), transparent 55%),linear-gradient(180deg,var(--glass) 0%,rgba(0,0,0,.24) 100%);border-color:#6ee7b7}
    @keyframes kShake{0%,100%{transform:translateX(0)}25%{transform:translateX(-4px)}75%{transform:translateX(4px)}}
    @keyframes keyHit{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
    .kLabel{font-weight:800;font-size:13px;text-align:center}
    .kSub{display:block;margin-top:4px;font-size:9px;color:var(--muted);font-weight:600}
    .kalimbaSwipeHint{margin-top:12px;font-size:12px;color:var(--muted);display:flex;gap:8px;align-items:flex-start}
    .swipeIcon{font-size:16px;opacity:.8}

    /* ===== Kalimba Fullscreen ===== */
    .kalimbaFullscreen{position:fixed;inset:0;background:rgba(0,0,0,.95);display:none;align-items:center;justify-content:center;z-index:500;padding:16px;backdrop-filter:blur(12px)}
    .kalimbaFullscreen.show{display:flex}
    .kalimbaFullscreenCard{width:min(1000px,100%);max-height:100%;background:rgba(13,15,26,.98);border:1px solid var(--border-light);border-radius:24px;overflow:hidden;box-shadow:0 30px 100px rgba(0,0,0,.8);display:flex;flex-direction:column}
    .kalimbaFullscreenTop{display:flex;align-items:center;gap:10px;padding:14px 20px;border-bottom:1px solid var(--border);flex-wrap:wrap;flex-shrink:0}
    .kalimbaFullscreenTop b{font-family:'Playfair Display',serif;font-size:16px}
    .kalimbaFullscreenTop .tip{font-size:12px;color:var(--muted)}
    .fullscreenScore{font-size:18px;font-weight:800;color:var(--accent2)}
    .kalimbaFullscreenBody{padding:16px;flex:1;overflow:auto;display:flex;flex-direction:column}
    .kalimbaFullscreenBody .kalimbaGameArea{flex:1;display:flex;flex-direction:column}
    .kalimbaFullscreenBody .fallingNotesTrack{flex:1;min-height:200px;height:auto}

    /* Landscape mode */
    .kalimbaFullscreen.landscape .kalimbaFullscreenCard{width:100%;height:100%;max-width:none;max-height:none;border-radius:0}
    .kalimbaFullscreen.landscape .kalimbaFullscreenTop{padding:10px 16px}
    .kalimbaFullscreen.landscape .kalimbaFullscreenBody{padding:10px}
    .kalimbaFullscreen.landscape .kKey{width:52px;min-width:52px}
    .kalimbaFullscreen.landscape .fallingBlock{width:50px}
    .kalimbaFullscreen.landscape .fallingNotesTrack{min-height:150px}

    @media(max-width:600px){
      .kKey{width:40px;min-width:40px}
      .fallingBlock{width:40px;height:45px;font-size:14px}
      .fallingNotesTrack{height:150px}
      .kalimbaFullscreen.landscape .kKey{width:44px;min-width:44px}
      .kalimbaFullscreen.landscape .fallingBlock{width:42px}
    }

    .scratch-container{position:relative;width:100%;max-width:420px;height:130px;margin:20px auto 0;border-radius:18px;overflow:hidden;box-shadow:0 16px 50px var(--shadow-color)}
    .scratch-reveal{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;text-align:center;padding:20px;font-size:20px;font-weight:700;background:linear-gradient(135deg,rgba(255,194,209,.15),rgba(212,184,255,.15));border:2px solid var(--border-light);border-radius:18px}
    .scratch-canvas{position:absolute;inset:0;border-radius:18px;cursor:crosshair;touch-action:none}

    .slot-machine{background:var(--glass);border:2px solid var(--border);border-radius:20px;padding:24px;text-align:center;margin-top:20px}
    .slot-display{display:flex;justify-content:center;gap:12px;margin:20px 0}
    .slot-item{width:85px;height:85px;background:linear-gradient(180deg,var(--glass) 0%,rgba(0,0,0,.3) 100%);border:2px solid var(--border-light);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:44px;box-shadow:inset 0 2px 10px rgba(0,0,0,.3);transition:all .2s}
    .slot-item.spinning{animation:slotSpin .1s infinite}
    @keyframes slotSpin{0%{transform:translateY(-4px)}50%{transform:translateY(4px)}100%{transform:translateY(-4px)}}
    .slot-result{min-height:55px;padding:14px;border-radius:14px;background:var(--glass);margin-top:16px;color:var(--muted);font-size:15px;border:1px solid var(--border)}

    .q{padding:18px;border-radius:18px;border:1px solid var(--border);background:var(--glass);margin-top:14px}
    .q b{font-size:15px}
    .opt{display:block;margin-top:12px;cursor:pointer;font-size:14px;color:var(--muted)}
    .opt:hover{color:var(--text)}
    .opt input{margin-right:10px}
    .result{display:none;margin-top:16px;padding:16px;border-radius:16px;border:1px solid rgba(167,243,208,.3);background:rgba(167,243,208,.08);font-size:15px}

    canvas#confetti{position:fixed;inset:0;pointer-events:none;z-index:100}
    .confetti-icon{position:fixed;bottom:30px;left:30px;font-size:50px;z-index:99;cursor:pointer;filter:drop-shadow(0 6px 20px rgba(0,0,0,.4));transition:transform .15s}
    .confetti-icon:hover{transform:scale(1.15) rotate(10deg)}
    .sparkle{position:fixed;pointer-events:none;font-size:22px;z-index:98;animation:sparkleAnim .8s forwards}
    @keyframes sparkleAnim{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0) translateY(-30px)}}
    .balloon{position:fixed;bottom:-100px;font-size:48px;z-index:97;animation:floatUp 7s forwards;pointer-events:none}
    @keyframes floatUp{0%{bottom:-100px}100%{bottom:110vh;opacity:0}}
    .floating-heart{position:fixed;font-size:30px;z-index:98;pointer-events:none;animation:heartFloat 1.6s forwards}
    @keyframes heartFloat{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-120px) scale(.6)}}
    .firework{position:fixed;width:8px;height:8px;border-radius:50%;pointer-events:none;z-index:101;animation:fireworkBurst .9s forwards}
    @keyframes fireworkBurst{0%{transform:translate(0,0);opacity:1}100%{transform:translate(var(--tx),var(--ty));opacity:0}}

    .music-btn{position:fixed;bottom:30px;right:30px;width:54px;height:54px;border-radius:50%;border:2px solid var(--border-light);background:var(--glass);backdrop-filter:blur(12px);color:#fff;font-size:24px;cursor:pointer;z-index:99;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 30px var(--shadow-color);transition:all .25s ease}
    .music-btn:hover{transform:scale(1.1);border-color:var(--accent1)}
    .music-btn.playing{animation:pulse-music 1.2s infinite;border-color:var(--accent1)}
    @keyframes pulse-music{0%,100%{box-shadow:0 0 0 0 rgba(255,194,209,.4)}50%{box-shadow:0 0 0 18px rgba(255,194,209,0)}}
    .music-modal{display:none;position:fixed;bottom:100px;right:30px;z-index:99}
    .music-modal.show{display:block}
    .music-modal-content{background:rgba(13,15,26,.95);backdrop-filter:blur(20px);border:1px solid var(--border-light);border-radius:18px;padding:14px;box-shadow:0 20px 60px rgba(0,0,0,.6)}
    .music-close{position:absolute;top:-12px;right:-12px;width:30px;height:30px;border-radius:50%;border:none;background:var(--accent1);color:#1a1a2e;font-weight:bold;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:transform .2s}
    .music-close:hover{transform:scale(1.1)}

    .loading{position:fixed;inset:0;background:var(--bg1);display:flex;align-items:center;justify-content:center;z-index:200;transition:opacity .5s}
    .loading.hide{opacity:0;pointer-events:none}
    .loadingText{font-family:'Playfair Display',serif;font-size:26px;font-weight:700;animation:blink 1s infinite}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:.5}}
    .countdown-overlay{position:fixed;inset:0;background:var(--bg1);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:300;transition:opacity .5s}
    .countdown-overlay.hide{opacity:0;pointer-events:none}
    .countdown-number{font-family:'Playfair Display',serif;font-size:160px;font-weight:900;background:linear-gradient(135deg,var(--accent1),var(--accent2),var(--accent3));-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:countPop .5s ease}
    .countdown-text{font-size:22px;color:var(--muted);margin-top:24px}
    @keyframes countPop{0%{transform:scale(.5);opacity:0}50%{transform:scale(1.15)}100%{transform:scale(1)}}

    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;padding:20px;z-index:50;backdrop-filter:blur(8px)}
    .modal{width:min(960px,100%);border-radius:24px;border:1px solid var(--border-light);background:rgba(13,15,26,.95);backdrop-filter:blur(20px);overflow:hidden;box-shadow:0 30px 100px rgba(0,0,0,.7)}
    .modalTop{display:flex;align-items:center;gap:12px;padding:16px 20px;border-bottom:1px solid var(--border);font-weight:600}
    .closeX{margin-left:auto}
    .modalBody{padding:20px}
    .videoBox{width:100%;aspect-ratio:16/9;border-radius:16px;border:2px dashed var(--border-light);display:grid;place-items:center;color:var(--muted);background:var(--glass);font-size:15px}

    .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%) translateY(20px);opacity:0;z-index:999;padding:10px 16px;border-radius:999px;border:1px solid var(--border-light);background:rgba(13,15,26,.85);backdrop-filter:blur(14px);color:var(--text);font-size:13px;font-weight:600;box-shadow:0 18px 60px rgba(0,0,0,.55);pointer-events:none;transition:opacity .25s ease, transform .25s ease}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

    @keyframes fortunePop{0%{opacity:0;transform:scale(0.8) translateY(10px)}50%{transform:scale(1.05) translateY(-5px)}100%{opacity:1;transform:scale(1) translateY(0)}}

    @media(prefers-reduced-motion:reduce){.reveal{opacity:1!important;transform:none!important}.progressBar{transition:none!important}}
  </style>
</head>
<body>
  <div class="loading" id="loading"><div class="loadingText">üéÇ ƒêang chu·∫©n b·ªã b·∫•t ng·ªù...</div></div>
  <div class="countdown-overlay" id="countdownOverlay">
    <div class="countdown-number" id="countdownNum">3</div>
    <div class="countdown-text">Chu·∫©n b·ªã ƒë√≥n b·∫•t ng·ªù...</div>
  </div>
  <canvas id="confetti"></canvas>
  <div class="confetti-icon" id="confettiIcon">üéä</div>
  <button class="music-btn" id="musicBtn" title="B·∫≠t nh·∫°c sinh nh·∫≠t">üéµ</button>
  <div class="music-modal" id="musicModal">
    <div class="music-modal-content">
      <button class="music-close" id="musicClose">‚úï</button>
      <iframe id="ytPlayer" width="300" height="200" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen style="border-radius:12px"></iframe>
    </div>
  </div>

  <div class="nav">
    <div class="navIn">
      <div class="brand" id="brand">‚ú® Birthday Spotlight</div>
      <button class="menuToggle" id="menuToggle">‚ò∞</button>
      <div class="links" id="navLinks">
        <a href="#spotlight">Spotlight</a><a href="#awards">D·∫•u ·∫•n</a><a href="#gallery">Gallery</a>
        <a href="#messages">L·ªùi ch√∫c</a><a href="#voice">Voice</a><a href="#kalimba">Kalimba</a>
        <a href="#scratch">C√†o</a><a href="#slot">Quay s·ªë</a><a href="#finale">Finale</a>
      </div>
      <div class="spacer"></div>
      <button class="btn" id="btnConfetti2">üéä B·∫Øn ph√°o</button>
    </div>
    <div class="progressWrap"><div class="progressBar" id="progressBar"></div></div>
  </div>

  <div class="wrap">
    <section class="grid grid2" id="spotlight" style="margin-top:24px">
      <div class="card hero">
        <div class="glow"></div>
        <div class="kicker">Jenny & Friends</div>
        <h1 id="title">Welcome Jenny to the world of love! <span style="-webkit-text-fill-color:initial;background:none">üéÇ</span></h1>
        <p><b>Ch√∫c Jenny b∆∞·ªõc sang tu·ªïi m·ªõi:</b></p>
        <p>‚ú® C√≥ nhi·ªÅu tr·∫£i nghi·ªám th√∫ v·ªã ·ªü nh·ªØng mi·ªÅn ƒë·∫•t m·ªõi, g·∫∑p th√™m nhi·ªÅu ng∆∞·ªùi d·ªÖ th∆∞∆°ng, d·ªÖ m·∫øn v√† nhi·ªÅu nƒÉng l∆∞·ª£ng t√≠ch c·ª±c</p>
        <p>‚ú® G·∫∑p nh·ªØng ƒëi·ªÅu t·ª≠ t·∫ø su·ªët c·∫£ nƒÉm, m·ªói ng√†y, m·ªói gi·ªù.</p>
        <div class="pillRow">
          <span class="pill">üëë Spotlight: ON</span>
          <span class="pill">üå∏ Birthday Girl</span>
          <span class="pill">üíñ World of Love</span>
        </div>
        <hr class="hr"/>
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <button class="btn btnPrimary" id="btnBoom">‚ú® B·∫•m m·ªü b·∫•t ng·ªù</button>
          <button class="btn" id="btnOpenVideo">üé¨ M·ªü video</button>
          <a class="btn" href="#messages">üíå Xem l·ªùi ch√∫c</a>
        </div>
        <div class="secret" id="secretNote">ü§´ Secret: "Jenny kh√≥ t√≠nh ƒë·ªÉ team gi·ªèi h∆°n ‚Äî c√≤n ngo√†i gi·ªù th√¨ Jenny mu·ªën m·ªçi ng∆∞·ªùi vui."</div>
      </div>
      <div class="card">
        <h2 id="spotlightTitle" style="cursor:pointer">Spotlight Story</h2>
        <div class="stat"><div class="dot"></div><div><b>üó£Ô∏è Kh√¥ng c·∫ßn n√≥i nhi·ªÅu‚Ä¶</b><p>Nh∆∞ng m·ªói l·∫ßn l√™n ti·∫øng l√† m·ªçi ng∆∞·ªùi ƒë·ªÅu l·∫Øng nghe.</p></div></div>
        <div class="stat"><div class="dot"></div><div><b>üîÆ D·ª± ƒëo√°n t∆∞∆°ng lai kkkk</b><p>"Ph√°n ƒëo√°n" s·ª± vi·ªác n√†o c≈©ng ƒë√∫ng.</p></div></div>
        <div class="stat"><div class="dot"></div><div><b>üìã Lu√¥n chu·∫©n b·ªã nhi·ªÅu plan</b><p>Cho m·ªôt t√¨nh hu·ªëng.</p></div></div>
        <hr class="hr"/><p style="font-size:13px;margin:0">üîÆ Nh·∫•n v√†o title ƒë·ªÉ xem l·ªùi ti√™n tri!</p>
        <div class="fortune-box" id="fortuneBox" style="display:none;margin-top:14px;padding:16px;border-radius:16px;border:1px solid rgba(212,184,255,.3);background:linear-gradient(135deg,rgba(212,184,255,.12),rgba(255,229,180,.08));text-align:center">
          <div style="font-size:28px;margin-bottom:8px">üîÆ‚ú®</div>
          <div id="fortuneText" style="font-size:15px;font-weight:600;color:var(--text)"></div>
        </div>
      </div>
    </section>

    <section class="card" id="awards" style="margin-top:20px">
      <div class="kicker">D·∫•u ·∫•n</div><h2>Awards & Achievements</h2>
      <div class="grid grid3" style="margin-top:16px">
        <div class="msgCard"><div class="who">‚è∞ Time Master</div><div class="quote">"Qu·∫£n l√Ω th·ªùi gian x·ªãn, kh√¥ng bao gi·ªù th·∫•y rush ho·∫∑c h·ªëi h·∫£."</div></div>
        <div class="msgCard"><div class="who">üòå Calm & Confident</div><div class="quote">"B√¨nh tƒ©nh v√† t·ª± tin trong m·ªçi ho√†n c·∫£nh."</div></div>
        <div class="msgCard"><div class="who">üíñ High EQ</div><div class="quote">"Nh·∫≠n bi·∫øt c·∫£m x√∫c c·ªßa ƒë·ªëi ph∆∞∆°ng chu·∫©n x√°c."</div></div>
        <div class="msgCard"><div class="who">‚ú® Problem Solver</div><div class="quote">"X·ª≠ l√Ω v·∫•n ƒë·ªÅ g·ªçn g√†ng, kh√¥ng ph·ª©c t·∫°p h∆°n m·ª©c c·∫ßn thi·∫øt."</div></div>
        <div class="msgCard"><div class="who">ü§ù Th·∫•u c·∫£m</div><div class="quote">"Lu√¥n hi·ªÉu v√† ƒë·ªìng c·∫£m v·ªõi m·ªçi ng∆∞·ªùi."</div></div>
        <div class="msgCard"><div class="who">üåü Role Model</div><div class="quote">"Trong c√°ch l√†m vi·ªác v√† ra quy·∫øt ƒë·ªãnh."</div></div>
      </div>
      <div class="highlight-box">
        <p style="margin:0;font-size:16px;color:var(--text)"><b>üëâ V√† ƒë·∫∑c bi·ªát l√† khi l√†m vi·ªác v·ªõi Jenny:</b></p>
        <p style="margin:10px 0 0">M·ªçi ng∆∞·ªùi th·∫•y y√™n t√¢m h∆°n, l√†m vi·ªác r√µ r√†ng h∆°n, v√†‚Ä¶ tin r·∫±ng m·ªçi th·ª© s·∫Ω ·ªïn! üíñ</p>
      </div>
    </section>

    <section class="card" id="gallery" style="margin-top:20px">
      <div class="kicker">Moments</div><h2>Kho·∫£nh kh·∫Øc n·ªïi b·∫≠t</h2><p>Nh·ªØng k·ª∑ ni·ªám ƒë√°ng nh·ªõ üíï</p>
      <div class="marquee" style="margin-top:16px"><div class="marqueeTrack">
        <img src="./anh1.JPG" class="marqueeImg" alt="·∫¢nh 1"><img src="./anh2.JPG" class="marqueeImg" alt="·∫¢nh 2"><img src="./anh3.jpg" class="marqueeImg" alt="·∫¢nh 3"><img src="./anh6.jpg" class="marqueeImg" alt="·∫¢nh 6"><img src="./anh7.jpg" class="marqueeImg" alt="·∫¢nh 7"><img src="./anh8.jpg" class="marqueeImg" alt="·∫¢nh 8"><img src="./anh9.jpg" class="marqueeImg" alt="·∫¢nh 9"><img src="./anh11.jpg" class="marqueeImg" alt="·∫¢nh 11">
        <img src="./anh1.JPG" class="marqueeImg" alt="·∫¢nh 1b"><img src="./anh2.JPG" class="marqueeImg" alt="·∫¢nh 2b"><img src="./anh3.jpg" class="marqueeImg" alt="·∫¢nh 3b"><img src="./anh6.jpg" class="marqueeImg" alt="·∫¢nh 6b"><img src="./anh7.jpg" class="marqueeImg" alt="·∫¢nh 7b"><img src="./anh8.jpg" class="marqueeImg" alt="·∫¢nh 8b"><img src="./anh9.jpg" class="marqueeImg" alt="·∫¢nh 9b"><img src="./anh11.jpg" class="marqueeImg" alt="·∫¢nh 11b">
      </div></div>
      <p style="margin-top:12px;font-size:13px">üí° Tip: Ch·∫°m/hover ƒë·ªÉ t·∫°m d·ª´ng.</p>
    </section>

    <section class="card" id="messages" style="margin-top:20px">
      <div class="kicker">From Friends with love</div><h2>L·ªùi ch√∫c t·ª´ nh·ªØng ng∆∞·ªùi d·ªÖ th∆∞∆°ng</h2>
      <p>Nh·ªØng l·ªùi ch√∫c ·∫•m √°p üíñ</p>
      <div class="msgGrid" id="msgGrid" style="margin-top:16px"></div>
    </section>

    <section class="card" id="voice" style="margin-top:20px">
      <div class="kicker">Voice Notes</div><h2>üéôÔ∏è L·ªùi ch√∫c b·∫±ng gi·ªçng n√≥i</h2><p>Nh·∫•n play ƒë·ªÉ nghe üíñ</p>
      <div class="msgGrid" style="margin-top:16px">
        <div class="msgCard audioCard"><div class="who">Qu·∫ø Nh∆∞</div><div class="quote">"QN ch√∫c b·∫£o b·ªëi sinh nh·∫≠t th·∫≠t zuiiiii, tu·ªïi m·ªõi th·∫≠t gi√†uuuuu üíñ"</div><audio controls><source src="./audio/voice_01.mp3" type="audio/mpeg"></audio></div>
        <div class="msgCard audioCard"><div class="who">Mr. ƒê·ªá</div><div class="quote">"Ch√∫c ch·ªã Tr√¢n tu·ªïi m·ªõi kh·ªèe re"</div><audio controls><source src="./audio/voice_02.mp3" type="audio/mpeg"></audio></div>
      </div>
    </section>

    <!-- Kalimba with Falling Notes -->
    <section class="card" id="kalimba" style="margin-top:20px">
      <div class="kicker">Kalimba</div><h2>üé∂ Kalimba ‚Äì Happy Birthday</h2>
      <p>B·∫•m "Ch∆°i game" ƒë·ªÉ n·ªët nh·∫°c r∆°i xu·ªëng - b·∫•m ph√≠m khi n·ªët ch·∫°m v·∫°ch! üéπ</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:14px">
        <button class="btn btnPrimary" id="btnStartGame">‚ñ∂Ô∏è Ch∆°i game</button>
        <button class="btn" id="btnStopGame">‚èπÔ∏è D·ª´ng</button>
        <button class="btn" id="btnAudioOn">üîä B·∫≠t √¢m thanh</button>
        <button class="btn" id="btnGuide">üß≠ H∆∞·ªõng d·∫´n: OFF</button>
        <button class="btn" id="btnResetSong">‚Ü∫ Reset b√†i</button>
        <button class="btn" id="btnKalimbaFull">‚õ∂ To√†n m√†n h√¨nh</button>
        <button class="btn" id="btnKalimbaRotate">üì± Xoay ngang</button>
      </div>
      <div class="kalimbaWrap" style="margin-top:16px">
        <div class="kalimbaTop">
          <div class="kalimbaHint">
            <b>G·ª£i √Ω b·∫•m (s·ªë ‚Äì n·ªët):</b>
            <div class="songLine">5 5 6 5 1' 7</div>
            <div class="songLine">5 5 6 5 2' 1'</div>
            <div class="songLine">5 5 5' 3' 1' 7 6</div>
            <div class="songLine">4' 4' 3' 1' 2' 1'</div>
            <div class="songNote">(Trong ƒê√¥ tr∆∞·ªüng: 1=C, 2=D, 3=E, 4=F, 5=G, 6=A, 7=B; d·∫•u ' l√† l√™n 1 qu√£ng 8)</div>
          </div>
          <div>
            <div class="kalimbaNow"><div class="nowTitle">üéØ Ph√≠m c·∫ßn b·∫•m:</div><div class="nowKey" id="nowKey">‚Äî</div><div class="nowSub" id="nowSub">B·∫≠t game ƒë·ªÉ b·∫Øt ƒë·∫ßu</div></div>
            <div class="kalimbaScore">
              <span class="scoreLabel">üéØ ƒêi·ªÉm:</span>
              <span class="scoreNum" id="scoreDisplay">0</span>
            </div>
          </div>
        </div>
        <div class="kalimbaGameArea" id="kalimbaGameArea">
          <div class="fallingNotesTrack" id="fallingNotesTrack"></div>
          <div class="hitZone"></div>
          <div class="kalimbaBoard" id="kalimbaBoard"></div>
        </div>
        <div class="kalimbaSwipeHint"><span class="swipeIcon">‚áÜ</span><div><b>M·∫πo:</b> Vu·ªët ngang tr√™n Kalimba ƒë·ªÉ xem ƒë·ªß ph√≠m.</div></div>
      </div>
    </section>

    <section class="card" id="scratch" style="margin-top:20px">
      <div class="kicker">B√≠ m·∫≠t</div><h2>üé´ C√†o l·ªô l·ªùi ch√∫c</h2><p>D√πng chu·ªôt/ng√≥n tay c√†o ƒë·ªÉ xem!</p>
      <div class="scratch-container" id="scratchContainer">
        <div class="scratch-reveal">üéÅ Ch√∫c Jenny GI√ÄU - ƒê·∫∏P - KH·ªéE! üíñ</div>
        <canvas class="scratch-canvas" id="scratchCanvas"></canvas>
      </div>
    </section>

    <section class="card" id="slot" style="margin-top:20px">
      <div class="kicker">V·∫≠n may</div><h2>üé∞ Quay s·ªë l·ªùi ch√∫c</h2>
      <div class="slot-machine">
        <div class="slot-display"><div class="slot-item" id="slot1">üéÇ</div><div class="slot-item" id="slot2">üéÅ</div><div class="slot-item" id="slot3">üéâ</div></div>
        <button class="btn btnPrimary" id="btnSpin">üé∞ Quay ngay!</button>
        <div class="slot-result" id="slotResult">B·∫•m ƒë·ªÉ nh·∫≠n l·ªùi ch√∫c!</div>
      </div>
    </section>

    <section class="card" id="quiz" style="margin-top:20px">
      <div class="kicker">Quiz</div><h2>Team hi·ªÉu Jenny t·ªõi ƒë√¢u?</h2>
      <div class="q"><b>C√¢u 1:</b> Mood c·ªßa Jenny khi cƒÉng?<label class="opt"><input type="radio" name="q1" value="0"> H∆°i g·∫Øt</label><label class="opt"><input type="radio" name="q1" value="1"> ƒêi·ªÅm tƒ©nh</label><label class="opt"><input type="radio" name="q1" value="0"> Im l·∫∑ng</label></div>
      <div class="q"><b>C√¢u 2:</b> Jenny mu·ªën team l√†m t·ªët?<label class="opt"><input type="radio" name="q2" value="0"> N√≥i hay</label><label class="opt"><input type="radio" name="q2" value="1"> Th·ª±c thi xu·∫•t s·∫Øc</label><label class="opt"><input type="radio" name="q2" value="0"> Reply nhanh</label></div>
      <div class="q"><b>C√¢u 3:</b> Signature c·ªßa Jenny?<label class="opt"><input type="radio" name="q3" value="1"> Chu·∫©n cao + h·ªó tr·ª£</label><label class="opt"><input type="radio" name="q3" value="0"> Vui t√≠nh</label><label class="opt"><input type="radio" name="q3" value="0"> Kh√¥ng feedback</label></div>
      <button class="btn btnPrimary" id="btnCheck" style="margin-top:16px">‚ú® Ch·∫•m ƒëi·ªÉm</button>
      <div class="result" id="quizResult"></div>
    </section>

    <section class="card" id="finale" style="margin-top:20px">
      <div class="kicker">Finale</div><h2>L·ªùi k·∫øt</h2>
      <p style="font-size:18px;color:var(--text)">Ch√∫c Jenny tu·ªïi m·ªõi th·∫≠t nhi·ªÅu nƒÉng l∆∞·ª£ng v√† lu√¥n r·ª±c r·ª°! üíñ</p>
      <div style="display:flex;gap:12px;margin-top:20px">
        <button class="btn btnPrimary" id="btnConfetti">üéâ B·∫Øn ph√°o</button>
        <a class="btn" href="#spotlight">‚¨ÜÔ∏è L√™n ƒë·∫ßu</a>
      </div>
    </section>
  </div>

  <div class="backdrop" id="backdrop"><div class="modal"><div class="modalTop"><b>üé¨ Video b·∫•t ng·ªù</b><button class="btn closeX" id="btnClose">‚úï</button></div><div class="modalBody"><div class="videoBox">VIDEO PLACEHOLDER</div></div></div></div>

  <!-- Kalimba Fullscreen Modal -->
  <div class="kalimbaFullscreen" id="kalimbaFullscreen">
    <div class="kalimbaFullscreenCard">
      <div class="kalimbaFullscreenTop">
        <b>üé∂ Kalimba ‚Äì Happy Birthday</b>
        <span class="tip">B·∫•m ph√≠m khi n·ªët ch·∫°m v·∫°ch!</span>
        <div class="spacer"></div>
        <div class="fullscreenScore">üéØ <span id="scoreDisplayFull">0</span></div>
        <button class="btn" id="btnStartGameFull">‚ñ∂Ô∏è Ch∆°i</button>
        <button class="btn" id="btnStopGameFull">‚èπÔ∏è D·ª´ng</button>
        <button class="btn" id="btnKalimbaRotateFull">üì± Xoay</button>
        <button class="btn" id="btnKalimbaClose">‚úï ƒê√≥ng</button>
      </div>
      <div class="kalimbaFullscreenBody">
        <div class="kalimbaGameArea" id="kalimbaGameAreaFull">
          <div class="fallingNotesTrack" id="fallingNotesTrackFull"></div>
          <div class="hitZone"></div>
          <div class="kalimbaBoard" id="kalimbaBoardFull"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const isCoarse=window.matchMedia&&window.matchMedia("(pointer:coarse)").matches;

    (function(){const progressBar=document.getElementById('progressBar');function updateProgress(){const doc=document.documentElement;const max=(doc.scrollHeight-doc.clientHeight)||1;const pct=Math.min(100,Math.max(0,(doc.scrollTop/max)*100));if(progressBar)progressBar.style.width=pct.toFixed(2)+'%'}window.addEventListener('scroll',updateProgress,{passive:true});window.addEventListener('resize',updateProgress);updateProgress()})();

    (function(){const links=[...document.querySelectorAll('#navLinks a')];const sections=links.map(a=>document.querySelector(a.getAttribute('href'))).filter(Boolean);if(!('IntersectionObserver' in window)||links.length===0)return;const io=new IntersectionObserver((entries)=>{for(const en of entries){if(!en.isIntersecting)continue;const id='#'+en.target.id;links.forEach(a=>a.classList.toggle('active',a.getAttribute('href')===id))}},{rootMargin:'-45% 0px -50% 0px',threshold:0.01});sections.forEach(s=>io.observe(s))})();

    (function(){const prefersReduce=window.matchMedia&&window.matchMedia('(prefers-reduced-motion:reduce)').matches;const cards=[...document.querySelectorAll('.card')];cards.forEach(c=>c.classList.add('reveal'));if(prefersReduce||!('IntersectionObserver' in window)){cards.forEach(c=>c.classList.add('in'));return}const ro=new IntersectionObserver((entries)=>{entries.forEach(e=>{if(e.isIntersecting){e.target.classList.add('in');ro.unobserve(e.target)}})},{threshold:0.08});cards.forEach(c=>ro.observe(c))})();

    const __toast=(function(){const el=document.getElementById('toast');let t=null;return function(msg){el.textContent=msg||'‚ú®';el.classList.add('show');clearTimeout(t);t=setTimeout(()=>el.classList.remove('show'),1400)}})();

    let count=3;const countdownOverlay=document.getElementById('countdownOverlay'),countdownNum=document.getElementById('countdownNum');
    function startCountdown(){document.getElementById('loading').classList.add('hide');const i=setInterval(()=>{count--;if(count>0){countdownNum.style.animation='none';countdownNum.offsetHeight;countdownNum.style.animation='countPop 0.5s';countdownNum.textContent=count}else if(count===0){countdownNum.textContent='üéâ';countdownNum.style.fontSize='140px'}else{clearInterval(i);countdownOverlay.classList.add('hide');setTimeout(boom,300);startBalloons()}},800)}
    window.addEventListener('load',()=>setTimeout(startCountdown,500));

    document.getElementById('menuToggle').onclick=()=>document.getElementById('navLinks').classList.toggle('show');

    const canvas=document.getElementById('confetti'),ctx=canvas.getContext('2d');let W,H,parts=[],running=false;
    function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight}addEventListener('resize',resize);resize();
    function spawn(n=240){const colors=['#ffc2d1','#ffe5b4','#d4b8ff','#b8e0ff','#a7f3d0','#f472b6'];for(let i=0;i<n;i++)parts.push({x:Math.random()*W,y:-20-Math.random()*H*.3,vx:(Math.random()-.5)*2.5,vy:3+Math.random()*5,s:4+Math.random()*8,r:Math.random()*Math.PI,vr:(Math.random()-.5)*.25,a:1,color:colors[Math.floor(Math.random()*colors.length)]});running=true}
    function tick(){if(!running)return;ctx.clearRect(0,0,W,H);parts.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.r+=p.vr;p.vy*=.996;p.vy+=.025;p.a*=.997;ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.r);ctx.globalAlpha=Math.max(0,p.a);ctx.fillStyle=p.color;ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s*.7);ctx.restore()});parts=parts.filter(p=>p.y<H+50&&p.a>.05);if(parts.length===0)running=false;requestAnimationFrame(tick)}
    function boom(){spawn(300);tick()}
    document.getElementById('btnBoom').onclick=boom;
    document.getElementById('btnConfetti').onclick=boom;
    document.getElementById('btnConfetti2').onclick=boom;

    const confettiIcon=document.getElementById('confettiIcon');
    if(!isCoarse){document.addEventListener('mousemove',e=>{const r=confettiIcon.getBoundingClientRect(),dx=e.clientX-(r.left+r.width/2),dy=e.clientY-(r.top+r.height/2),angle=Math.atan2(dy,dx)*(180/Math.PI);confettiIcon.style.transform='rotate('+(angle-90)+'deg)'})}
    confettiIcon.onclick=boom;

    const sparkles=['‚ú®','‚≠ê','üí´','üåü'];let sparkleT=0;
    if(!isCoarse){document.addEventListener('mousemove',e=>{if(Date.now()-sparkleT<90||Math.random()>.35)return;sparkleT=Date.now();const s=document.createElement('div');s.className='sparkle';s.textContent=sparkles[Math.floor(Math.random()*sparkles.length)];s.style.left=(e.clientX-11)+'px';s.style.top=(e.clientY-11)+'px';document.body.appendChild(s);setTimeout(()=>s.remove(),800)})}

    const balloons=['üéà','ü©∑','üíú','üíõ','ü©µ'];
    function createBalloon(){const b=document.createElement('div');b.className='balloon';b.textContent=balloons[Math.floor(Math.random()*balloons.length)];b.style.left=Math.random()*(innerWidth-50)+'px';b.style.animationDuration=(6+Math.random()*4)+'s';document.body.appendChild(b);setTimeout(()=>b.remove(),11000)}
    function startBalloons(){for(let i=0;i<12;i++)setTimeout(createBalloon,i*250);setInterval(createBalloon,3500)}

    document.addEventListener('click',e=>{if(['BUTTON','INPUT','A','AUDIO'].includes(e.target.tagName))return;const hearts=['üíñ','üíï','üíó','ü©∑'];for(let i=0;i<3;i++)setTimeout(()=>{const h=document.createElement('div');h.className='floating-heart';h.textContent=hearts[Math.floor(Math.random()*hearts.length)];h.style.left=(e.clientX-15)+'px';h.style.top=(e.clientY-15)+'px';document.body.appendChild(h);setTimeout(()=>h.remove(),1600)},i*100)});

    document.querySelectorAll('.card').forEach(c=>c.addEventListener('click',e=>{if(['BUTTON','INPUT','AUDIO'].includes(e.target.tagName))return;const colors=['#ffc2d1','#ffe5b4','#d4b8ff','#b8e0ff'];for(let i=0;i<14;i++){const f=document.createElement('div');f.className='firework';f.style.left=e.clientX+'px';f.style.top=e.clientY+'px';f.style.background=colors[Math.floor(Math.random()*colors.length)];const angle=(i/14)*Math.PI*2,dist=55+Math.random()*55;f.style.setProperty('--tx',Math.cos(angle)*dist+'px');f.style.setProperty('--ty',Math.sin(angle)*dist+'px');document.body.appendChild(f);setTimeout(()=>f.remove(),900)}}));

    const musicBtn=document.getElementById('musicBtn'),musicModal=document.getElementById('musicModal'),musicClose=document.getElementById('musicClose'),ytPlayer=document.getElementById('ytPlayer');
    const youtubeVideoId='Uc7DfbBcfvk';let musicOpen=false;
    musicBtn.onclick=()=>{if(!musicOpen){ytPlayer.src='https://www.youtube.com/embed/'+youtubeVideoId+'?autoplay=1&loop=1&playlist='+youtubeVideoId;musicModal.classList.add('show');musicBtn.textContent='üîä';musicBtn.classList.add('playing')}else{ytPlayer.src='';musicModal.classList.remove('show');musicBtn.textContent='üéµ';musicBtn.classList.remove('playing')}musicOpen=!musicOpen};
    musicClose.onclick=()=>{ytPlayer.src='';musicModal.classList.remove('show');musicBtn.textContent='üéµ';musicBtn.classList.remove('playing');musicOpen=false};

    const scratchCanvas=document.getElementById('scratchCanvas'),scratchCtx=scratchCanvas.getContext('2d'),scratchContainer=document.getElementById('scratchContainer');let isScratching=false,scratchReady=false;
    function initScratch(){const rect=scratchContainer.getBoundingClientRect();if(rect.width===0||rect.height===0)return;scratchCanvas.width=rect.width;scratchCanvas.height=rect.height;scratchCtx.globalCompositeOperation='source-over';const gradient=scratchCtx.createLinearGradient(0,0,rect.width,rect.height);gradient.addColorStop(0,'#ffc2d1');gradient.addColorStop(0.5,'#d4b8ff');gradient.addColorStop(1,'#ffe5b4');scratchCtx.fillStyle=gradient;scratchCtx.fillRect(0,0,rect.width,rect.height);scratchCtx.fillStyle='rgba(255,255,255,0.95)';scratchCtx.font='bold 20px "DM Sans",system-ui';scratchCtx.textAlign='center';scratchCtx.textBaseline='middle';scratchCtx.fillText('üéÅ C√†o t·∫°i ƒë√¢y ƒë·ªÉ xem!',rect.width/2,rect.height/2);scratchReady=true}
    function doScratch(x,y){if(!scratchReady)return;scratchCtx.globalCompositeOperation='destination-out';scratchCtx.beginPath();scratchCtx.arc(x,y,32,0,Math.PI*2);scratchCtx.fill()}
    function handleScratch(e){if(!isScratching)return;e.preventDefault();const rect=scratchCanvas.getBoundingClientRect();let x,y;if(e.touches){x=e.touches[0].clientX-rect.left;y=e.touches[0].clientY-rect.top}else{x=e.clientX-rect.left;y=e.clientY-rect.top}doScratch(x,y)}
    scratchCanvas.addEventListener('mousedown',e=>{isScratching=true;handleScratch(e)});scratchCanvas.addEventListener('mouseup',()=>isScratching=false);scratchCanvas.addEventListener('mouseleave',()=>isScratching=false);scratchCanvas.addEventListener('mousemove',handleScratch);scratchCanvas.addEventListener('touchstart',e=>{isScratching=true;handleScratch(e)},{passive:false});scratchCanvas.addEventListener('touchend',()=>isScratching=false);scratchCanvas.addEventListener('touchmove',handleScratch,{passive:false});
    window.addEventListener('load',()=>setTimeout(initScratch,500));window.addEventListener('resize',()=>{scratchReady=false;setTimeout(initScratch,100)});

    const slotEmojis=['üéÇ','üéÅ','üéâ','üéà','üíñ','‚≠ê','üéä','üíé'],slotMsgs=['üî• JACKPOT! Ch√∫c Jenny GI√ÄU S·ª§!','‚ú® Ch√∫c Jenny T·ªéA S√ÅNG!','üíñ Ch√∫c Jenny ƒë∆∞·ª£c Y√äU TH∆Ø∆†NG!','üéØ Ch√∫c Jenny ƒê·∫†T M·ªåI M·ª§C TI√äU!','üí™ Ch√∫c Jenny S·ª®C KH·ªéE d·ªìi d√†o!','üöÄ Ch√∫c Jenny THƒÇNG TI·∫æN!','üòÑ Ch√∫c Jenny H·∫†NH PH√öC!','üëë Ch√∫c Jenny lu√¥n l√† QUEEN!'];
    const slot1=document.getElementById('slot1'),slot2=document.getElementById('slot2'),slot3=document.getElementById('slot3'),slotResult=document.getElementById('slotResult');let isSpinning=false;
    document.getElementById('btnSpin').onclick=()=>{if(isSpinning)return;isSpinning=true;slot1.classList.add('spinning');slot2.classList.add('spinning');slot3.classList.add('spinning');slotResult.textContent='üé∞ ƒêang quay...';const spin=setInterval(()=>{slot1.textContent=slotEmojis[Math.floor(Math.random()*slotEmojis.length)];slot2.textContent=slotEmojis[Math.floor(Math.random()*slotEmojis.length)];slot3.textContent=slotEmojis[Math.floor(Math.random()*slotEmojis.length)]},100);setTimeout(()=>{slot1.classList.remove('spinning');slot1.textContent=slotEmojis[Math.floor(Math.random()*slotEmojis.length)]},1000);setTimeout(()=>{slot2.classList.remove('spinning');slot2.textContent=slotEmojis[Math.floor(Math.random()*slotEmojis.length)]},1500);setTimeout(()=>{clearInterval(spin);slot3.classList.remove('spinning');slot3.textContent=slotEmojis[Math.floor(Math.random()*slotEmojis.length)];slotResult.textContent=slotMsgs[Math.floor(Math.random()*slotMsgs.length)];boom();isSpinning=false},2000)};

    const backdrop=document.getElementById('backdrop');
    document.getElementById('btnOpenVideo').onclick=()=>backdrop.style.display='flex';
    document.getElementById('btnClose').onclick=()=>backdrop.style.display='none';
    backdrop.onclick=e=>{if(e.target===backdrop)backdrop.style.display='none'};

    const secret=document.getElementById('secretNote');
    document.getElementById('title').ondblclick=()=>secret.style.display=secret.style.display==='block'?'none':'block';
    document.getElementById('brand').ondblclick=()=>secret.style.display=secret.style.display==='block'?'none':'block';

    document.getElementById('btnCheck').onclick=()=>{const pick=n=>{const el=document.querySelector('input[name="'+n+'"]:checked');return el?Number(el.value):null};const a=pick('q1'),b=pick('q2'),c=pick('q3'),res=document.getElementById('quizResult');if(a===null||b===null||c===null){res.style.display='block';res.textContent='Ch·ªçn ƒë·ªß 3 c√¢u nha üòÑ';return}const score=a+b+c;res.style.display='block';if(score===3){res.textContent='üî• 3/3! Team hi·ªÉu Jenny qu√° chu·∫©n!';boom()}else if(score===2)res.textContent='‚ú® 2/3! Kh√° ƒë√∫ng vibe!';else res.textContent='üòÑ 0‚Äì1/3! Quan tr·ªçng l√† ch√¢n th√†nh!'};

    const messages=[{name:"Quin Quin",text:"D√π nh√¨u moment h∆°i ups and downs, nh∆∞ng v·∫´n mong l√†m chung team th·∫≠t l√¢u nha! M√£i b√™n nhau b·∫°n nh√≥e!!"},{name:"Mr. ƒê·ªá",text:"S·∫øp g√¨ ·∫°. M√ÉI ƒê·ªàNH M√ÉI KH·ªéE"}];
    const msgGrid=document.getElementById("msgGrid");
    if(msgGrid){msgGrid.innerHTML=messages.map(m=>'<div class="msgCard"><div class="who">'+m.name+'</div>'+(m.tag?'<div class="tag">'+m.tag+'</div>':'')+'<div class="quote">"'+m.text+'"</div></div>').join("")}

    // Fortune
    (function(){const fortunes=["üí∞ NƒÉm nay Jenny s·∫Ω ƒë∆∞·ª£c tƒÉng l∆∞∆°ng 200%!","‚úàÔ∏è Jenny s·∫Øp c√≥ chuy·∫øn du l·ªãch b·∫•t ng·ªù!","üíé‚ú® Jenny shines brighter than diamonds! üíé‚ú®","üåü V≈© tr·ª• ƒëang chu·∫©n b·ªã ƒëi·ªÅu tuy·ªát v·ªùi cho Jenny!","üéÅ M·ªôt b·∫•t ng·ªù l·ªõn ƒëang ƒë·∫øn v·ªõi Jenny!","üëë Jenny s·∫Ω ƒë∆∞·ª£c c√¥ng nh·∫≠n x·ª©ng ƒë√°ng trong nƒÉm nay!","üçÄ May m·∫Øn s·∫Ω theo Jenny su·ªët 365 ng√†y!","üíñ Ai ƒë√≥ ƒëang ng·∫ßm ng∆∞·ª°ng m·ªô Jenny ƒë·∫•y!"];const spotlightTitle=document.getElementById('spotlightTitle');const fortuneBox=document.getElementById('fortuneBox');const fortuneText=document.getElementById('fortuneText');if(spotlightTitle&&fortuneBox&&fortuneText){spotlightTitle.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();fortuneText.textContent=fortunes[Math.floor(Math.random()*fortunes.length)];fortuneBox.style.display='block';fortuneBox.style.animation='none';void fortuneBox.offsetHeight;fortuneBox.style.animation='fortunePop 0.4s ease';boom();__toast('üîÆ L·ªùi ti√™n tri ƒë√£ xu·∫•t hi·ªán!')})}})();

    // ========== KALIMBA WITH FALLING NOTES GAME ==========
    (function(){
      const board = document.getElementById('kalimbaBoard');
      const boardFull = document.getElementById('kalimbaBoardFull');
      const fallingTrack = document.getElementById('fallingNotesTrack');
      const fallingTrackFull = document.getElementById('fallingNotesTrackFull');
      const kalimbaFullscreen = document.getElementById('kalimbaFullscreen');
      const btnStart = document.getElementById('btnStartGame');
      const btnStop = document.getElementById('btnStopGame');
      const btnStartFull = document.getElementById('btnStartGameFull');
      const btnStopFull = document.getElementById('btnStopGameFull');
      const btnAudioOn = document.getElementById('btnAudioOn');
      const btnGuide = document.getElementById('btnGuide');
      const btnResetSong = document.getElementById('btnResetSong');
      const btnKalimbaFull = document.getElementById('btnKalimbaFull');
      const btnKalimbaRotate = document.getElementById('btnKalimbaRotate');
      const btnKalimbaRotateFull = document.getElementById('btnKalimbaRotateFull');
      const btnKalimbaClose = document.getElementById('btnKalimbaClose');
      const nowKey = document.getElementById('nowKey');
      const nowSub = document.getElementById('nowSub');
      const scoreDisplay = document.getElementById('scoreDisplay');
      const scoreDisplayFull = document.getElementById('scoreDisplayFull');

      const keys = [
        {id:'C4',deg:'1',freq:261.63},{id:'D4',deg:'2',freq:293.66},{id:'E4',deg:'3',freq:329.63},
        {id:'F4',deg:'4',freq:349.23},{id:'G4',deg:'5',freq:392.00},{id:'A4',deg:'6',freq:440.00},
        {id:'B4',deg:'7',freq:493.88},{id:'C5',deg:"1'",freq:523.25},{id:'D5',deg:"2'",freq:587.33},
        {id:'E5',deg:"3'",freq:659.25},{id:'F5',deg:"4'",freq:698.46},{id:'G5',deg:"5'",freq:783.99}
      ];

      const song = [
        {k:4,d:400},{k:4,d:400},{k:5,d:400},{k:4,d:400},{k:7,d:400},{k:6,d:800},
        {k:4,d:400},{k:4,d:400},{k:5,d:400},{k:4,d:400},{k:8,d:400},{k:7,d:800},
        {k:4,d:400},{k:4,d:400},{k:11,d:400},{k:9,d:400},{k:7,d:400},{k:6,d:400},{k:5,d:800},
        {k:10,d:400},{k:10,d:400},{k:9,d:400},{k:7,d:400},{k:8,d:400},{k:7,d:800}
      ];

      let audioCtx = null;
      let gameRunning = false;
      let guideOn = false;
      let isFullscreen = false;
      let score = 0;
      let step = 0;
      let animationId = null;
      let fallingBlocks = [];
      let noteIndex = 0;
      let lastSpawnTime = 0;
      let trackHeight = 180;
      const speedPxPerSec = 110;
      const spawnInterval = 650;
      let lastFrameTime = 0;

      function getActiveBoard(){ return isFullscreen ? boardFull : board; }
      function getActiveTrack(){ return isFullscreen ? fallingTrackFull : fallingTrack; }

      function updateTrackHeight(){
        const track = getActiveTrack();
        if(track) trackHeight = track.getBoundingClientRect().height || 180;
      }

      function buildBoard(el){
        if(!el) return;
        const center = Math.floor(keys.length/2);
        el.innerHTML = keys.map((k,i)=>{
          const dist = Math.abs(i-center);
          const height = Math.max(90,160-dist*8);
          return '<button class="kKey" data-index="'+i+'" style="height:'+height+'px"><div class="kLabel">'+k.deg+'<span class="kSub">'+k.id+'</span></div></button>';
        }).join('');
      }
      buildBoard(board);
      buildBoard(boardFull);

      function ensureAudio(){if(audioCtx)return audioCtx;const AC=window.AudioContext||window.webkitAudioContext;audioCtx=new AC();return audioCtx}
      function pluck(freq){
        const ctx=ensureAudio();if(ctx.state==='suspended')ctx.resume();const t=ctx.currentTime;
        const osc=ctx.createOscillator();osc.type='triangle';osc.frequency.setValueAtTime(freq,t);
        const osc2=ctx.createOscillator();osc2.type='sine';osc2.frequency.setValueAtTime(freq*2.01,t);
        const g=ctx.createGain();g.gain.setValueAtTime(0.0001,t);g.gain.exponentialRampToValueAtTime(0.5,t+0.01);g.gain.exponentialRampToValueAtTime(0.0001,t+1);
        const lp=ctx.createBiquadFilter();lp.type='lowpass';lp.frequency.setValueAtTime(4000,t);
        osc.connect(g);osc2.connect(g);g.connect(lp);lp.connect(ctx.destination);
        osc.start(t);osc2.start(t);osc.stop(t+1.1);osc2.stop(t+1.1);
      }

      function spawnBlock(){
        if(noteIndex >= song.length) noteIndex = 0;
        const note = song[noteIndex];
        const activeBoard = getActiveBoard();
        const activeTrack = getActiveTrack();
        const keyBtn = activeBoard.querySelector('.kKey[data-index="'+note.k+'"]');
        if(!keyBtn || !activeTrack) return;

        const keyRect = keyBtn.getBoundingClientRect();
        const trackRect = activeTrack.getBoundingClientRect();
        const blockWidth = isFullscreen ? 50 : 46;
        const leftPos = keyRect.left - trackRect.left + (keyRect.width - blockWidth)/2;

        const block = document.createElement('div');
        block.className = 'fallingBlock';
        block.textContent = keys[note.k].deg;
        block.style.left = leftPos + 'px';
        block.style.top = '-50px';
        block.style.width = blockWidth + 'px';
        activeTrack.appendChild(block);

        fallingBlocks.push({el:block,keyIndex:note.k,y:-50,hit:false,missed:false});
        noteIndex++;
      }

      function handleKeyPress(idx, fromBoard){
        const activeBoard = fromBoard || getActiveBoard();
        const keyBtn = activeBoard.querySelector('.kKey[data-index="'+idx+'"]');
        pluck(keys[idx].freq);

        if(!gameRunning){
          if(keyBtn){keyBtn.classList.add('hit');setTimeout(()=>keyBtn.classList.remove('hit'),250)}
          if(guideOn){
            const targetId = song[step].k;
            if(idx === targetId){step = (step+1) % song.length;setGuide()}
            else if(keyBtn){keyBtn.classList.add('wrong');setTimeout(()=>keyBtn.classList.remove('wrong'),200)}
          }
          return;
        }

        const hitZone = 35;
        let hitBlock = null;
        fallingBlocks.forEach(block=>{
          if(block.keyIndex === idx && !block.hit && !block.missed){
            const blockBottom = block.y + 50;
            if(blockBottom >= trackHeight - hitZone && block.y <= trackHeight + hitZone){
              if(!hitBlock || block.y > hitBlock.y) hitBlock = block;
            }
          }
        });

        if(hitBlock){
          hitBlock.hit = true;
          hitBlock.el.classList.add('hit');
          if(keyBtn){keyBtn.classList.add('hit');setTimeout(()=>keyBtn.classList.remove('hit'),250)}
          score += 10;
          updateScoreDisplay();
          __toast('‚ú® +10');
        } else if(keyBtn){
          keyBtn.classList.add('hit');
          setTimeout(()=>keyBtn.classList.remove('hit'),250);
        }
      }

      function updateScoreDisplay(){
        if(scoreDisplay) scoreDisplay.textContent = score;
        if(scoreDisplayFull) scoreDisplayFull.textContent = score;
      }

      [board, boardFull].forEach(b=>{
        if(!b) return;
        b.addEventListener('pointerdown',e=>{
          const btn = e.target.closest('.kKey');
          if(!btn) return;
          handleKeyPress(parseInt(btn.dataset.index), b);
        });
      });

      function gameLoop(timestamp){
        if(!gameRunning) return;
        if(timestamp - lastSpawnTime > spawnInterval){spawnBlock();lastSpawnTime = timestamp}
        if(!lastFrameTime) lastFrameTime = timestamp;
        const dt = Math.min(0.03, (timestamp - lastFrameTime) / 1000);
        lastFrameTime = timestamp;

        fallingBlocks.forEach(block=>{
          if(block.hit) return;
          block.y += speedPxPerSec * dt;
          block.el.style.top = block.y + 'px';
          if(block.y > trackHeight + 20 && !block.missed && !block.hit){block.missed = true;block.el.classList.add('missed')}
        });

        fallingBlocks = fallingBlocks.filter(b=>{
          if(b.hit && b.el.parentNode){setTimeout(()=>b.el.remove(),300);return false}
          if(b.y > trackHeight + 70){b.el.remove();return false}
          return true;
        });

        if(fallingBlocks.length > 0){
          const next = fallingBlocks.find(b=>!b.hit && !b.missed);
          if(next){nowKey.textContent = keys[next.keyIndex].deg;nowSub.textContent = 'ƒêi·ªÉm: ' + score}
        }
        animationId = requestAnimationFrame(gameLoop);
      }

      function setGuide(){
        [board, boardFull].forEach(b=>{if(b) b.querySelectorAll('.kKey').forEach(k=>k.classList.remove('guide'))});
        if(!guideOn){nowKey.textContent='‚Äî';nowSub.textContent='B·∫≠t h∆∞·ªõng d·∫´n ƒë·ªÉ b·∫Øt ƒë·∫ßu';return}
        const target = song[step];
        nowKey.textContent = keys[target.k].deg + ' ('+keys[target.k].id+')';
        nowSub.textContent = 'B∆∞·ªõc '+(step+1)+'/'+song.length;
        [board, boardFull].forEach(b=>{if(!b) return;const btn = b.querySelector('.kKey[data-index="'+target.k+'"]');if(btn) btn.classList.add('guide')});
      }

      function startGame(){
        if(gameRunning) return;
        ensureAudio();
        updateTrackHeight();
        gameRunning = true;
        guideOn = false;
        btnGuide.textContent = 'üß≠ H∆∞·ªõng d·∫´n: OFF';
        score = 0;
        noteIndex = 0;
        updateScoreDisplay();
        fallingBlocks.forEach(b=>b.el.remove());
        fallingBlocks = [];
        [board, boardFull].forEach(b=>{if(b) b.querySelectorAll('.kKey').forEach(k=>k.classList.remove('guide'))});
        nowKey.textContent = 'üéÆ';
        nowSub.textContent = 'Game ƒëang ch·∫°y!';
        lastFrameTime = 0;
        lastSpawnTime = performance.now();
        animationId = requestAnimationFrame(gameLoop);
        __toast('üéπ Game b·∫Øt ƒë·∫ßu!');
      }

      function stopGame(){
        gameRunning = false;
        if(animationId) cancelAnimationFrame(animationId);
        nowKey.textContent = '‚èπÔ∏è';
        nowSub.textContent = 'ƒêi·ªÉm: ' + score;
        if(score >= 100){boom();__toast('üéâ Xu·∫•t s·∫Øc! '+score+' ƒëi·ªÉm!')}
        else __toast('‚èπÔ∏è D·ª´ng game');
      }

      function openFullscreen(landscape){
        if(gameRunning) stopGame();
        isFullscreen = true;
        kalimbaFullscreen.classList.add('show');
        if(landscape) kalimbaFullscreen.classList.add('landscape');
        document.body.classList.add('noScroll');
        setTimeout(updateTrackHeight, 100);
        __toast(landscape ? 'üì± Xoay ngang' : '‚õ∂ To√†n m√†n h√¨nh');
      }

      function closeFullscreen(){
        if(gameRunning) stopGame();
        isFullscreen = false;
        kalimbaFullscreen.classList.remove('show','landscape');
        document.body.classList.remove('noScroll');
        updateTrackHeight();
        __toast('‚úï ƒê√£ ƒë√≥ng');
      }

      function toggleLandscape(){
        kalimbaFullscreen.classList.toggle('landscape');
        setTimeout(updateTrackHeight, 100);
        __toast(kalimbaFullscreen.classList.contains('landscape') ? 'üì± Xoay ngang' : 'üì± Xoay d·ªçc');
      }

      btnStart.onclick = startGame;
      btnStop.onclick = stopGame;
      if(btnStartFull) btnStartFull.onclick = startGame;
      if(btnStopFull) btnStopFull.onclick = stopGame;
      btnAudioOn.onclick = ()=>{ensureAudio();if(audioCtx&&audioCtx.state==='suspended')audioCtx.resume();__toast('üîä √Çm thanh ƒë√£ b·∫≠t!')};
      btnGuide.onclick = ()=>{
        if(gameRunning){__toast('‚ö†Ô∏è D·ª´ng game tr∆∞·ªõc!');return}
        guideOn = !guideOn;
        btnGuide.textContent = guideOn ? 'üß≠ H∆∞·ªõng d·∫´n: ON' : 'üß≠ H∆∞·ªõng d·∫´n: OFF';
        setGuide();
        __toast(guideOn ? 'üß≠ H∆∞·ªõng d·∫´n: ON' : 'üß≠ H∆∞·ªõng d·∫´n: OFF');
      };
      btnResetSong.onclick = ()=>{step=0;setGuide();__toast('‚Ü∫ ƒê√£ reset b√†i')};
      
      if(btnKalimbaFull) btnKalimbaFull.onclick = ()=>openFullscreen(false);
      if(btnKalimbaRotate) btnKalimbaRotate.onclick = ()=>openFullscreen(true);
      if(btnKalimbaRotateFull) btnKalimbaRotateFull.onclick = toggleLandscape;
      if(btnKalimbaClose) btnKalimbaClose.onclick = closeFullscreen;
      if(kalimbaFullscreen) kalimbaFullscreen.onclick = e=>{if(e.target===kalimbaFullscreen)closeFullscreen()};

      updateTrackHeight();
      window.addEventListener('resize', updateTrackHeight);
      setGuide();
    })();
  </script>
</body>
</html>
